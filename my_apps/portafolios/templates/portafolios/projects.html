{% extends "../base.html" %}

{% block title %}Proyectos{% endblock %}

{% block content %}

<!-- BOTÓN CREAR PROYECTO (solo admins / permiso) -->
{% if user.is_authenticated and perms.portafolios.add_project %}
<div class="d-flex justify-content-end mb-4">
    <a href="{% url 'portafolios:create' %}" class="btn btn-success">
        <i class="bi bi-plus-circle"></i> Crear proyecto
    </a>
</div>
{% endif %}

<!-- SLIDER TOP PROJECTS -->
{% if top_projects %}
<div id="topProjectsCarousel" class="carousel slide mb-5" data-bs-ride="carousel">
    <div class="carousel-inner rounded shadow-sm">

        {% for project in top_projects %}
        <div class="carousel-item {% if forloop.first %}active{% endif %}">
            <img src="{{ project.image.url }}" class="d-block w-100" alt="{{ project.title }}"
                 style="max-height: 420px; object-fit: cover;">

            <div class="carousel-caption d-none d-md-block bg-dark bg-opacity-50 rounded p-3">
                <h5>{{ project.title }}</h5>

                <!-- MÉTRICAS -->
                <div class="d-flex justify-content-center gap-4 mt-2 small">
                    <span class="d-flex align-items-center gap-1">
                        <i class="bi bi-heart-fill text-danger"></i>
                        {{ project.total_likes }}
                    </span>
                    <span class="d-flex align-items-center gap-1">
                        <i class="bi bi-eye-fill"></i>
                        {{ project.total_views }}
                    </span>
                    <span class="d-flex align-items-center gap-1">
                        <i class="bi bi-chat-dots-fill"></i>
                        {{ project.total_comments }}
                    </span>
                </div>

                <a href="{% url 'portafolios:detail' project.id %}"
                   class="btn btn-sm btn-outline-light mt-2">
                    Ver proyecto
                </a>
            </div>
        </div>
        {% endfor %}

    </div>

    <button class="carousel-control-prev" type="button"
            data-bs-target="#topProjectsCarousel" data-bs-slide="prev">
        <span class="carousel-control-prev-icon"></span>
    </button>
    <button class="carousel-control-next" type="button"
            data-bs-target="#topProjectsCarousel" data-bs-slide="next">
        <span class="carousel-control-next-icon"></span>
    </button>
</div>
{% endif %}

<!-- FILTRO POR TAGS -->
<div class="mb-4 d-flex flex-wrap gap-2">
    <a href="{% url 'portafolios:projects' %}"
       class="btn btn-sm {% if not selected_tag %}btn-success{% else %}btn-outline-success{% endif %}">
        Todos
    </a>

    {% for tag in tags %}
    <a href="{% url 'portafolios:projects' %}?tag={{ tag.slug }}"
       class="btn btn-sm {% if selected_tag == tag.slug %}btn-success{% else %}btn-outline-success{% endif %}">
        {{ tag.name }}
    </a>
    {% endfor %}
</div>

<!-- LISTADO GENERAL DE PROYECTOS -->
<div class="row g-4">
    {% for project in projects %}
    <div class="col-sm-6 col-lg-4">
        <div class="card h-100 shadow-sm border-0">

            <img src="{{ project.image.url }}"
                 class="card-img-top"
                 alt="{{ project.title }}"
                 style="height: 200px; object-fit: cover;">

            <div class="card-body d-flex flex-column">
                <h5 class="card-title">{{ project.title }}</h5>
                <p class="card-text text-muted small">
                    {{ project.description|truncatechars:120 }}
                </p>

                <!-- MÉTRICAS -->
                <div class="mt-auto d-flex justify-content-between align-items-center text-muted small">
                    <div class="d-flex gap-3">
                        <span class="d-flex align-items-center gap-1">
                            <i class="bi bi-heart-fill text-danger"></i>
                            {{ project.total_likes }}
                        </span>
                        <span class="d-flex align-items-center gap-1">
                            <i class="bi bi-eye-fill"></i>
                            {{ project.total_views }}
                        </span>
                        <span class="d-flex align-items-center gap-1">
                            <i class="bi bi-chat-dots-fill"></i>
                            {{ project.total_comments }}
                        </span>
                    </div>

                    <a href="{% url 'portafolios:detail' project.id %}"
                       class="btn btn-sm btn-outline-success">
                        Ver más
                    </a>
                </div>
            </div>
        </div>
    </div>
    {% empty %}
    <div class="col-12 text-center text-muted">
        No hay proyectos disponibles.
    </div>
    {% endfor %}
</div>

{% endblock %}
